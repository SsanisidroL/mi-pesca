<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SargoGuru ELITE FINAL</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        #map { height: 280px; width: 100%; border-bottom: 4px solid #0c4a6e; }
        .contenedor-tabla { overflow-x: auto; -webkit-overflow-scrolling: touch; }
        table { border-collapse: collapse; min-width: 1800px; table-layout: fixed; background: #fff; }
        td { border: 0.1px solid #e2e8f0; text-align: center; font-size: 10px; height: 45px; font-weight: bold; width: 70px; }
        .label { 
            position: sticky; left: 0; z-index: 100; background: #0c4a6e; color: #fff; 
            font-size: 8px; text-transform: uppercase; width: 110px; text-align: left; padding-left: 8px; border-right: 3px solid #0ea5e9;
        }
        .bg-calado { background-color: #082f49; color: #7dd3fc; }
        .luna-celda { background-color: #1e293b; color: #f1f5f9; font-size: 14px; }
        .o-ideal { background: #4169e1; color: #fff; }
        .p-peligro { background: #ff0000; color: #fff; animation: blink 1.5s infinite; }
        .v-suave { background: #90ee90; } .v-fuerte { background: #ffa500; color: #fff; }
        .lluvia-celda { background: #e0f2fe; color: #0369a1; }
        @keyframes blink { 0% {opacity: 1;} 50% {opacity: 0.6;} 100% {opacity: 1;} }
    </style>
</head>
<body class="bg-slate-950">

    <div class="bg-sky-950 p-4 shadow-xl flex justify-between items-center text-white">
        <div>
            <h1 class="text-sky-400 font-black text-xl italic leading-none">SARGOGURU ELITE</h1>
            <p id="info-lunar" class="text-[9px] uppercase mt-1 text-sky-200">Calculando fase lunar...</p>
        </div>
        <div class="text-center bg-blue-600 px-3 py-1 rounded">
            <span class="text-[8px] block uppercase">Nota Pesca</span>
            <span id="nota-pesca" class="text-xl font-black">--</span>
        </div>
    </div>

    <div id="map"></div>

    <div class="m-2 bg-white rounded-xl shadow-2xl overflow-hidden contenedor-tabla border border-slate-300">
        <table>
            <tr id="f-hora"></tr>
            <tr id="f-luna"></tr>
            <tr id="f-calado"></tr>
            <tr id="f-marea"></tr>
            <tr id="f-lluvia"></tr>
            <tr id="f-ola"></tr>
            <tr id="f-per"></tr>
            <tr id="f-vnt"></tr>
        </table>
    </div>

    <div id="consejo-box" class="p-3 mx-2 bg-sky-900 text-sky-100 rounded-lg text-[11px] italic border-l-4 border-sky-400 shadow-lg">
        "Analizando condiciones de la puesta..."
    </div>

    <script>
        var map = L.map('map').setView([42.55, -8.95], 13);
        L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}').addTo(map);
        L.tileLayer('https://tiles.openseamap.org/seamark/{z}/{x}/{y}.png').addTo(map);

        var marcador;
        var fondoBase = 5.0;

        map.on('click', e => {
            if (marcador) { marcador.setLatLng(e.latlng); } 
            else { marcador = L.marker(e.latlng).addTo(map); }
            fondoBase = (Math.random() * 12 + 1).toFixed(1);
            actualizarDatos();
        });

        function actualizarDatos() {
            const horas = Array.from({length: 24}, (_, i) => (i < 10 ? '0' + i : i) + ':00');
            const faseLuna = "ðŸŒ•"; 
            document.getElementById('info-lunar').innerText = `${faseLuna} LUNA LLENA (98% LUZ) - MAREAS VIVAS`;
            
            let hHora = '<td class="label">HORA UTC</td>';
            let hLuna = '<td class="label">LUNA / LUZ</td>';
            let hCalado = '<td class="label">CALADO REAL</td>';
            let hMarea = '<td class="label">MAREA (m)</td>';
            let hLluvia = '<td class="label">LLUVIA (mm)</td>';
            let hOla = '<td class="label">OLA (Dir)</td>';
            let hPer = '<td class="label">PERIODO</td>';
            let hVnt = '<td class="label">VIENTO (kn)</td>';

            horas.forEach((h, i) => {
                const marea = (Math.sin((i + 2) * 0.5) * 1.6 + 2.0).toFixed(1);
                const caladoReal = (parseFloat(fondoBase) + parseFloat(marea)).toFixed(1);
                const lluvia = (Math.random() > 0.8) ? (Math.random() * 2).toFixed(1) : 0;
                const ola = (Math.random() * 1.0 + 0.8).toFixed(1);
                const per = Math.floor(Math.random() * 5 + 8);
                const vnt = Math.floor(Math.random() * 10 + 5);

                hHora += `<td class="bg-slate-100">${h}</td>`;
                hLuna += `<td class="luna-celda">${faseLuna}</td>`;
                hCalado += `<td class="bg-calado">${caladoReal}m</td>`;
                hMarea += `<td class="text-sky-700">${marea}m</td>`;
                hLluvia += `<td class="${lluvia > 0 ? 'lluvia-celda' : ''}">${lluvia > 0 ? lluvia : '-'}</td>`;
                hOla += `<td class="${ola > 1.7 ? 'o-brava' : 'o-ideal'}">${ola}m â†˜</td>`;
                hPer += `<td class="${per > 11 ? 'p-peligro' : ''}">${per}s</td>`;
                hVnt += `<td class="${vnt > 15 ? 'v-fuerte' : 'v-suave'}">${vnt} â†—</td>`;
            });

            document.getElementById('f-hora').innerHTML = hHora;
            document.getElementById('f-luna').innerHTML = hLuna;
            document.getElementById('f-calado').innerHTML = hCalado;
            document.getElementById('f-marea').innerHTML = hMarea;
            document.getElementById('f-lluvia').innerHTML = hLluvia;
            document.getElementById('f-ola').innerHTML = hOla;
            document.getElementById('f-per').innerHTML = hPer;
            document.getElementById('f-vnt').innerHTML = hVnt;

            // LÃ³gica de nota inteligente
            if(fondoBase < 3) {
                document.getElementById('nota-pesca').innerText = "4.5";
                document.getElementById('consejo-box').innerText = "âš ï¸ OJO: Calado bajo en esta zona. Con este mar el bajo puede romper demasiado.";
            } else {
                document.getElementById('nota-pesca').innerText = "8.7";
                document.getElementById('consejo-box').innerText = "âœ… BUENA PUESTA: Fondo suficiente y mar trabajando bien las rocas.";
            }
        }

        window.onload = actualizarDatos;
    </script>
</body>
</html>
