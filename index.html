<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SargoGuru CARTA N√ÅUTICA</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        #map { height: 350px; width: 100%; border-bottom: 3px solid #075985; }
        .contenedor-tabla { overflow-x: auto; -webkit-overflow-scrolling: touch; }
        table { border-collapse: collapse; min-width: 1800px; table-layout: fixed; background: #fff; }
        td { border: 0.1px solid #e2e8f0; text-align: center; font-size: 10px; height: 40px; font-weight: bold; width: 70px; }
        .label { 
            position: sticky; left: 0; z-index: 100; background: #0c4a6e; color: #f0f9ff; 
            font-size: 8px; text-transform: uppercase; width: 110px; text-align: left; padding-left: 8px; border-right: 3px solid #0ea5e9;
        }
        .bg-calado { background-color: #082f49; color: #7dd3fc; }
        .o-ideal { background: #4169e1; color: #fff; }
        .p-peligro { background: #ff0000; color: #fff; animation: blink 1.5s infinite; }
        @keyframes blink { 0% {opacity: 1;} 50% {opacity: 0.6;} 100% {opacity: 1;} }
    </style>
</head>
<body class="bg-slate-100">

    <div class="bg-sky-950 p-4 shadow-xl flex justify-between items-center text-white">
        <div>
            <h1 class="text-sky-400 font-black text-xl italic leading-none uppercase">Carta N√°utica Pro</h1>
            <p class="text-[9px] uppercase tracking-widest opacity-80 mt-1">Batimetr√≠a y Ayudas a la Navegaci√≥n</p>
        </div>
        <div class="bg-sky-900 px-3 py-1 rounded border border-sky-700">
            <span id="coord-display" class="text-[9px] font-mono text-sky-300">ZONA: GALICIA</span>
        </div>
    </div>

    <div id="map"></div>

    <div class="m-2 bg-white rounded-xl shadow-2xl overflow-hidden contenedor-tabla border border-slate-300">
        <table>
            <tr id="f-hora"></tr>
            <tr id="f-calado"></tr>
            <tr id="f-marea"></tr>
            <tr id="f-ola"></tr>
            <tr id="f-per"></tr>
            <tr id="f-vnt"></tr>
        </table>
    </div>

    <div class="p-4 mx-2 bg-sky-50 rounded-lg border border-sky-200 shadow-inner">
        <h3 class="text-sky-900 font-bold text-xs uppercase mb-1">Leyenda de la Carta:</h3>
        <div class="grid grid-cols-2 gap-2 text-[9px] text-sky-700">
            <p>‚öì <b>N√∫meros:</b> Profundidad en bajamar (metros).</p>
            <p>üö© <b>Iconos:</b> Boyas, balizas y faros reales.</p>
        </div>
    </div>

    <script>
        // 1. Inicializar mapa
        var map = L.map('map').setView([42.55, -8.95], 13);

        // 2. Capa base (H√≠brida: Sat√©lite + Calles suaves)
        var satellite = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}');
        
        // 3. CAPA N√ÅUTICA (OpenSeaMap)
        var nautical = L.tileLayer('https://tiles.openseamap.org/seamark/{z}/{x}/{y}.png', {
            attribution: 'Map data &copy; OpenSeaMap contributors'
        });

        // A√±adimos ambas: el sat√©lite abajo y la carta n√°utica encima (transparente)
        satellite.addTo(map);
        nautical.addTo(map);

        var marcador;
        var fondoBase = 5.0;

        map.on('click', e => {
            if (marcador) { marcador.setLatLng(e.latlng); } 
            else { marcador = L.marker(e.latlng).addTo(map); }
            
            document.getElementById('coord-display').innerText = `${e.latlng.lat.toFixed(4)}N ${Math.abs(e.latlng.lng).toFixed(4)}W`;
            
            // Simulaci√≥n de profundidad base (Z)
            fondoBase = (Math.random() * 15 + 1).toFixed(1);
            actualizarDatos();
        });

        function actualizarDatos() {
            const horas = Array.from({length: 24}, (_, i) => (i < 10 ? '0' + i : i) + ':00');
            
            let hHora = '<td class="label">HORA UTC</td>';
            let hCalado = '<td class="label">CALADO REAL</td>';
            let hMarea = '<td class="label">MAREA (m)</td>';
            let hOla = '<td class="label">OLA (m)</td>';
            let hPer = '<td class="label">PER (s)</td>';
            let hVnt = '<td class="label">VNT (kn)</td>';

            horas.forEach((h, i) => {
                const marea = (Math.sin((i + 2) * 0.5) * 1.6 + 2.0).toFixed(1);
                const caladoReal = (parseFloat(fondoBase) + parseFloat(marea)).toFixed(1);
                const ola = (Math.random() * 1.0 + 0.8).toFixed(1);
                const per = Math.floor(Math.random() * 5 + 8);
                const vnt = Math.floor(Math.random() * 10 + 5);

                hHora += `<td class="bg-slate-100">${h}</td>`;
                hCalado += `<td class="bg-calado">${caladoReal}m</td>`;
                hMarea += `<td class="text-sky-700">${marea}m</td>`;
                hOla += `<td class="${ola > 1.7 ? 'o-brava' : 'o-ideal'}">${ola}m</td>`;
                hPer += `<td class="${per > 11 ? 'p-peligro' : ''}">${per}s</td>`;
                hVnt += `<td>${vnt}</td>`;
            });

            document.getElementById('f-hora').innerHTML = hHora;
            document.getElementById('f-calado').innerHTML = hCalado;
            document.getElementById('f-marea').innerHTML = hMarea;
            document.getElementById('f-ola').innerHTML = hOla;
            document.getElementById('f-per').innerHTML = hPer;
            document.getElementById('f-vnt').innerHTML = hVnt;
        }

        window.onload = actualizarDatos;
    </script>
</body>
</html>
