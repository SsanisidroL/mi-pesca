<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Mapa de Viento - Rías de Noia y Arousa</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { font-family: sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        #map { height: 50%; width: 100%; border-bottom: 2px solid #ccc; }
        #widget-container { height: 50%; width: 100%; background: #f4f4f4; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .info-msg { color: #666; font-style: italic; }
        h3 { margin: 10px; font-size: 16px; color: #333; }
    </style>
</head>
<body>

    <div id="map"></div>
    
    <div id="widget-container">
        <h3 id="spot-name">Selecciona un punto en el mapa para ver la previsión</h3>
        <div id="windguru-embed" style="width: 100%; height: 100%;">
            <p class="info-msg">Haz clic en un marcador (azul para Noia, rojo para Arousa)</p>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Configuración inicial del mapa centrada en las dos rías
        const map = L.map('map').setView([42.65, -8.95], 10);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap'
        }).addTo(map);

        // Lista ampliada de spots de Windguru
        const spots = [
            // --- RÍA DE MUROS E NOIA ---
            { name: "Muros", id: 499696, lat: 42.774, lng: -9.057, ria: "noia" },
            { name: "Noia (Testal)", id: 122550, lat: 42.783, lng: -8.910, ria: "noia" },
            { name: "Portosín", id: 208206, lat: 42.760, lng: -8.940, ria: "noia" },
            { name: "Playa de Aguieira", id: 48734, lat: 42.740, lng: -8.960, ria: "noia" },
            { name: "Louro (Ancoradoiro)", id: 14670, lat: 42.760, lng: -9.100, ria: "noia" },

            // --- RÍA DE AROUSA ---
            { name: "Ribeira (Sta. Uxía)", id: 388522, lat: 42.568, lng: -8.980, ria: "arousa" },
            { name: "Boiro (Playa Barraña)", id: 501118, lat: 42.640, lng: -8.880, ria: "arousa" },
            { name: "Vilagarcía de Arousa", id: 475161, lat: 42.595, lng: -8.765, ria: "arousa" },
            { name: "Illa de Arousa", id: 48737, lat: 42.555, lng: -8.875, ria: "arousa" },
            { name: "Cambados", id: 217403, lat: 42.515, lng: -8.815, ria: "arousa" },
            { name: "O Grove (La Lanzada)", id: 32516, lat: 42.450, lng: -8.875, ria: "arousa" },
            { name: "Lourido (San Salvador)", id: 188276, lat: 42.420, lng: -8.674, ria: "arousa" }
        ];

        const container = document.getElementById('windguru-embed');
        const nameDisplay = document.getElementById('spot-name');

        // Función para cargar el widget de Windguru
        function loadWindguru(spotId, spotName) {
            nameDisplay.innerText = "Previsión para: " + spotName;
            container.innerHTML = `
                <iframe 
                    src="https://www.windguru.cz/int/distr.php?u=${spotId}&s=${spotId}&m=3&p=WIND,GUST,DIR,TMPE&USD=1" 
                    style="width:100%; height:100%; border:none;">
                </iframe>`;
        }

        // Añadir marcadores al mapa
        spots.forEach(spot => {
            // Color diferenciado por ría
            const color = spot.ria === "noia" ? "blue" : "red";
            
            const marker = L.marker([spot.lat, spot.lng]).addTo(map);
            marker.bindTooltip(spot.name, { permanent: false, direction: 'top' });

            marker.on('click', () => {
                loadWindguru(spot.id, spot.name);
            });
        });
    </script>
</body>
</html>
